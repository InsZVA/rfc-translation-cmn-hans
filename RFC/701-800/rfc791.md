RFC 791 网际协议
========

目录
--------

+ [x] 1 [介绍](#1-介绍)
  - [x] 1.1 [动机](#11-动机)
  - [x] 1.2 [范围](#12-范围)
  - [x] 1.3 [接口](#13-接口)
  - [x] 1.4 [操作](#14-操作)
+ [ ] 2 [概览](#2-概览)
  - [x] 2.1 [与其他协议的联系](#21-与其他协议的联系)
  - [x] 2.2 [操作模型](#22-操作模型)
  - [ ] 2.3 [功能描述](#23-功能描述)
  - [x] 2.4 [网关](#24-网关)
+ [ ] 3 [规范](#3-规范)
  - [ ] 3.1 [IP头部格式](#31-IP头部格式)
  - [ ] 3.2 [讨论](#32-讨论)
  - [ ] 3.3 [接口](#33-接口)
+ [ ] 附录A [范例](#附录a-范例)
+ [ ] 附录B [数据传输顺序](#附录b-数据传输顺序)
+ [x] [词汇表](#词汇表)
+ [x] [参考](#参考)


1 介绍
--------

### 1.1 动机

网际协议是为包交换计算机通讯网络的互联系统设计的。这样的系统先前被称为“catenet”[1]。网际协议提供从源到目标的数据块传输——这被称为数据报，其中源和目标都由固定长度的地址确定主机。如果需要在“小包”网络中传输，则网际协议也可提供长数据报的分片和重组。


### 1.2 范围

网际协议仅限于提供通过网络互联系统从源到目标传输位包（IP数据报）所需的功能。它没有增强端到端数据可靠性、流控制、排序的机制，或者其他常见的主机到主机的协议的功能。网际协议可以利用其支持网络的服务来提供不同类型和质量的服务。


### 1.3 接口

本协议由互联网环境中的主机到主机的协议调用。本协议调用本地网络协议，用于将IP数据报带往下一个网关或目标主机。

例如，TCP模块会调用IP模块并将一个TCP分片（包含TCP头部和用户数据）作为IP数据报的数据部分。TCP模块会在IP头部中提供地址及其他作为调用IP模块的参数。随后IP模块会生成一个IP数据报并调用本地网络接口来传输IP数据报。

例如，在ARPANET中，IP模块会调用本地网络模块，而本地网络模块会在IP数据报前添加1822头部[2]来创建一条发送给IMP的ARPANET信息。本地网络接口会从IP地址中获取ARPANET地址，这个地址为ARPANET中某些主机的地址，且这些主机可能为通向其他网络的网关。


### 1.4 操作

网际协议实现了两个基本功能：寻址和分片。

IP模块使用存放于IP头部的地址将IP数据报发送至目标。传输路径的选择被称为路由。

当需要在“小包”网络中传输时，IP模块使用IP头部中的域来分片或重组IP数据报。

操作模型是指驻留在每一个进行互联网通信的主机和连接网络的网关中的IP模块。这些模块共享相同的解释地址域以及分片及重组IP数据报的规则。此外，这些模块（特别是网关）拥有进行路由决策和其他功能的程序。

网际协议将每一个IP数据报作为独立的实体，且与其他IP数据报无关。它没有连接或逻辑回路（虚拟或其他的）。

网际协议使用四个主要机制来提供它的服务：服务类型、生存时间、选项和头部校验和。

服务类型用于表明期望的服务质量。服务类型是抽象或普遍的参数集合，这些参数描述了组成互联网的网络中提供的服务选择。服务类型标示会在路由IP数据报时被网关用于选择特定网络的传输参数，下一跳（？）的网络，或下一个网关。

生存时间用于表明IP数据报的最大生存时间。它由发送者设置，且每次被路由处理时减少。如果生存时间在IP数据报达到目标前达到0，则这个IP数据报将被摧毁。生存时间可被看做自我销毁时间限制。

选项提供了在某些情况下有用但在大多数通常通讯中不需要的控制功能。选项包含提供时间戳、安全和特殊路由。

头部校验和提供了用于处理IP数据报是否被正确发送的验证。数据可能包含错误。如果头部校验和出错，则IP数据报将立即被检测到错误的实体丢弃。

网际协议不提供可靠的通讯机制。它没有端到端或逐跳（？）的确认机制。它没有数据的错误控制，只有头部校验和。它没有重传机制。它也没有流控制。

错误检测可以通过互联网控制消息协议（ICMP）[3]报告，它被实现在IP模块中。


2 概览
--------

### 2.1 与其他协议的联系

下图说明了网际协议在协议分层中的位置：

    +------+ +-----+ +-----+     +-----+
    |Telnet| | FTP | | TFTP| ... | ... |
    +------+ +-----+ +-----+     +-----+
          |   |         |           |
         +-----+     +-----+     +-----+
         | TCP |     | UDP | ... | ... |
         +-----+     +-----+     +-----+
            |           |           |
         +--------------------------+----+
         |    Internet Protocol & ICMP   |
         +--------------------------+----+
                        |
           +---------------------------+
           |   Local Network Protocol  |
           +---------------------------+

图1 协议关系

网际协议的接口一边是更高级别的主机到主机的协议，另一边是本地网络协议。在这个上下文中“本地网络”可以是一栋建筑中的小网络，或是像ARPANET这样的大网络。


### 2.2 操作模型

将一个数据报从一个应用程序发送到另一个应用程序的操作模型由以下方案说明：

* 我们假设传输会涉及到一个中间网关。
* 发送方应用程序准备好数据并调用它的本地IP模块，将数据作为数据报发送，并将目标地址及其他参数作为调用的参数。
* IP模块准备数据报头部并附加数据，IP模块为这个IP地址决定本地网络地址，在这个示例中这是网关的地址。
* IP模块将数据报和本地网络地址发送给本地网络接口。
* 本地网络接口创建一个本地网络头部，并将数据报附加到其后，然后将结果通过本地网络发送。
* 数据报到达本地网络头部中指定的网关主机，本地网络接口截去本地网络头部，并将数据报传递给IP模块。IP模块通过IP地址判断数据报应当被转发给第二个网络中的另一个主机。它会调用第二个网络中的本地网络接口来发送数据报。
* 本地网络接口创建一个本地网络头部，并将数据报附加到其后，然后将结果发送给目标主机。
* 在目标主机中数据报被本地网络接口截去本地网络头部，并将它传递给IP模块。
* IP模块判断该数据包是发送给当前主机上的一个应用程序。它将数据作为系统调用的回应传递给应用程序，并将源地址及其他参数作为调用的结果。

    Application                                           Application
    Program                                                   Program
          \                                                   /
        Internet Module      Internet Module      Internet Module
              \                 /       \                /
              LNI-1          LNI-1      LNI-2         LNI-2
                 \           /             \          /
                Local Network 1           Local Network 2

图2 传输路径


### 2.3 功能描述

网际协议的功能或目的是在一系列互相连接的网络间移动数据报。这是通过将数据报在IP模块间传输直到抵达目标来完成的。IP模块存在于互联网系统中的主机和网关。数据报从一个IP模块被路由到另一个IP模块并穿过不同的网络，这基于IP地址的解释。因此，网际协议的一个重要机制是IP地址。

在IP模块间路由消息的过程中，数据报可能需要穿过最大包大小小于数据报大小的网络。网际协议提供了分片机制来克服这个困难。

#### 寻址

#### 分片


### 2.4 网关

网关实现网际协议来在网络间传递数据报。网关也实现了网关对网关协议（GGP）[7]来协调路由和其他IP控制信息。

在网关中不必实现更高级别的协议，且GGP功能会被附加到IP模块中。

      +-------------------------------+
      | Internet Protocol & ICMP & GGP|
      +-------------------------------+
              |                 |
    +---------------+   +---------------+
    |   Local Net   |   |   Local Net   |
    +---------------+   +---------------+

图3 网关协议


3 规范
--------

### 3.1 IP头部格式


### 3.2 讨论


### 3.3 接口


附录A 范例
--------


附录B 数据传输顺序
--------


词汇表
--------

### 1822
BBN报告1822，“The Specification of the Interconnection of a Host and an IMP”。  它是主机与ARPANET间接口的标准。

### ARPANET头部（ARPANET leader）
主机-IMP接口中ARPANET消息的控制信息。

### ARPANET消息（ARPANET message）
ARPANET中主机与IMP间传输的单位。最大大小约为1012个八位位组（8096位）。

### ARPANET包（ARPANET packet）
ARPANET中IMP间内部使用的传输单位。最大大小约为126个八位位组（1008位）。

### 目标（Destination）
目标地址，一个IP头部域。

### DF
标志域中携带的不分片（Don't Fragment）位。

### 标志（Flags）
一个包含各种控制标志的IP头部域。

### 分片位移（Fragment Offset）
用于标示分片在IP数据报中位置的IP头部域。

### GGP
网关对网关协议（Gateway to Gateway Protocol），此协议主要用于网关间的路由控制和其他网关功能。

### 头部（header）
消息、段、数据报、包或数据块开头的控制信息。

### ICMP
互联网控制消息协议（Internet Control Message Protocol），在IP模块中实现，它被用于网关与主机以及主机之间报告错误并进行路由建议。

### 识别（Identification）
一个包含由发送者赋值的标识值的IP头部域，用于帮助重组数据报的分片。

### IHL
IP头部中的IP头部长度（Internet Header Length）域，它是以32位为单位的IP头部长度。

### IMP
接口消息处理器（Interface Message Processor），ARPANET的包交换机。

### IP地址（Internet Address）
四个八位位组（32位）组成的源或目标地址，由网络地址域和主机地址域组成。

### IP数据报（internet datagram）
一对IP模块间进行数据交换的基本单位（包含IP头部）。

### IP分片（internet fragment）
带有一个IP头部的IP数据报的一部分数据。

### 本地地址（Local Address）
网络中主机的地址。网络中本地地址到主机地址的实际映射相当普遍，允许多对一的映射。

### MF
IP头部中标志域包含的更多分片（More-Fragments）标志。

### 模块（module）
一个协议或其他过程的实现，通常是软件。

### 更多分片标志（more-fragments flag）
IP头部中标志语包含的用于标示当前IP数据报是否包含一个IP数据报的结尾的标志。

### NFB
一个IP分片中的数据部分的分片块数量（Number of Fragment Blocks）。也就是说，以8个八位位组为单位的一部分数据的长度。

### 八位位组（octet）
一个包含八位的字节。

### 选项（Options）
IP头部中的选项域可包含各种选项，且每个选项的长度可为若干八位位组。

### 填充（Padding）
IP头部中用于保证数据以32位对齐开始的填充域。填充的值为0。

### 协议（Protocol）
在本文档中，协议是更高级的协议的标识符，是一个IP头部域。

### 剩余（Rest）
IP地址中的主机部分。

### 源（Source）
源地址，一个IP头部域。

### TCP
传输控制协议（Transmission Control Protocol）：用于互联网环境中可靠通信的主机到主机协议。

### TCP段（TCP Segment）
TCP模块间传输数据的单位（包含TCP头部）。

### TFTP
简单文件传输协议（Trivial File Transfer Protocol）：基于UDP的简单的文件传输协议。

### 生存时间（Time to Live）
一个用于标示IP数据包能够存在的最长时间的IP头部域。

### TOS
服务类型（Type of Service）

### 总长度（Total Length）
以八位位组为单位的用于标示数据报长度的IP头部域，包含IP头部及数据。

### TTL
生存时间（Time to Live）。

### 服务类型（Type of Service）
一个用于标示IP数据包的服务的类型（或质量）的IP头部域。

### UDP
用户数据报协议（User Datagram Protocol）：一个面向事务的用户级别协议。

### 用户（User）
网际协议的用户。这可能是更高级别的协议模块，应用程序，或者是网关程序。

### 版本（Version）
用于标示IP头部格式的版本域。


参考
--------

[1] Cerf, V., "The Catenet Model for Internetworking," Information Processing Techniques Office, Defense Advanced Research Projects Agency, IEN 48, July 1978.

[2] Bolt Beranek and Newman, "Specification for the Interconnection of a Host and an IMP," BBN Technical Report 1822, Revised May 1978.

[3] Postel, J., "Internet Control Message Protocol - DARPA Internet Program Protocol Specification," RFC 792, USC/Information Sciences Institute, September 1981.

[4] Shoch, J., "Inter-Network Naming, Addressing, and Routing," COMPCON, IEEE Computer Society, Fall 1978.

[5] Postel, J., "Address Mappings," RFC 796, USC/Information Sciences Institute, September 1981.

[6] Shoch, J., "Packet Fragmentation in Inter-Network Protocols," Computer Networks, v. 3, n. 1, February 1979.

[7] Strazisar, V., "How to Build a Gateway", IEN 109, Bolt Beranek and Newman, August 1979.

[8] Postel, J., "Service Mappings," RFC 795, USC/Information Sciences Institute, September 1981.

[9] Postel, J., "Assigned Numbers," RFC 790, USC/Information Sciences Institute, September 1981.
